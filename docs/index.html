<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mijoro Boutique ‚Äî Version Pro</title>
  
  <!-- ‚úÖ PWA META TAGS (CRITICAL) -->
  <meta name="description" content="Boutique de produits num√©riques malagasy - eBooks, vid√©os, apps et jeux pour r√©ussir en ligne. D√©couvrez nos formations, guides et outils pour entrepreneurs digitaux √† Madagascar.">
  <meta name="theme-color" content="#1e88e5">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f1216">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mijoro">
  
  <!-- ‚úÖ NOUVEAUX META TAGS - CAPABILITIES -->
  <meta name="file-handler" content="enabled">
  <meta name="file-handler-types" content="application/pdf,image/jpeg,image/png,image/webp,image/gif">
  <link rel="protocol-handler" href="/?action=protocol&url=%s" protocol="web+mijoro">
  <meta name="widget-support" content="enabled">
  <meta name="widget-update-frequency" content="3600">
  
  <!-- ‚úÖ MANIFEST LINK -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- ‚úÖ APPLE ICONS (Relative paths) -->
  <link rel="apple-touch-icon" sizes="192x192" href="./icons/android-launchericon-192-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="./icons/android-launchericon-144-144.png">
  <link rel="apple-touch-icon" sizes="144x144" href="./icons/android-launchericon-144-144.png">
  <link rel="apple-touch-icon" sizes="512x512" href="./icons/512x512-monochrome.png">
  
  <!-- ‚úÖ FAVICON -->
  <link rel="icon" type="image/png" sizes="192x192" href="./icons/android-launchericon-192-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="./icons/android-launchericon-512-512.png">

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Preconnect pour performances -->
  <link rel="preconnect" href="https://i.ibb.co">
  <link rel="preconnect" href="https://zogohkfzplcuonkkfoov.supabase.co">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  
  <!-- ‚úÖ NOUVEAU: Preconnect Widgets -->
  <link rel="preconnect" href="https://widget-api.pwabuilder.com" crossorigin>
  <link rel="dns-prefetch" href="https://widget-api.pwabuilder.com">
 
  <!-- ‚úÖ ENHANCED NOSCRIPT FALLBACK -->
<noscript>
  <div style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;padding:20px;background:#0a0e17;border:2px solid #ef4444;border-radius:12px;max-width:400px;z-index:99999">
    <i class="fa-solid fa-exclamation-triangle" style="font-size:48px;color:#ef4444;margin-bottom:16px"></i>
    <h3 style="color:#fff;margin:0 0 12px">JavaScript requis</h3>
    <p style="color:#94a3b8;margin:0;line-height:1.6">
      Cette application n√©cessite JavaScript pour fonctionner correctement.
    </p>
  </div>
</noscript>
  
  <!-- ‚úÖ PWA TAGS SUPPLEMENTAIRES -->
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="application-name" content="Mijoro">
  <meta name="msapplication-TileColor" content="#0a0e17">
  <meta name="msapplication-TileImage" content="./icons/android-launchericon-144-144.png">

  <!-- ‚úÖ iOS SPLASH SCREENS -->
  <link rel="apple-touch-startup-image" href="./icons/android-launchericon-512-512.png">
  
  <!-- ‚úÖ PWA INSTALL PROMPT STYLES -->
  <style>
    /* Install prompter */
    #pwa-install-banner {
      position: fixed;
      bottom: 80px;
      left: 12px;
      right: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      display: none;
      z-index: 9999;
      animation: slideUp 0.4s ease;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    #pwa-install-banner.show {
      display: block;
    }
    
    .pwa-banner-content {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .pwa-banner-icon {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .pwa-banner-text h4 {
      margin: 0 0 4px 0;
      font-size: 16px;
      font-weight: 700;
    }
    
    .pwa-banner-text p {
      margin: 0;
      font-size: 13px;
      opacity: 0.9;
    }
    
    .pwa-banner-actions {
      display: flex;
      gap: 8px;
    }
    
    .pwa-banner-actions button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .pwa-install-btn {
      background: #fff;
      color: #667eea;
    }
    
    .pwa-dismiss-btn {
      background: rgba(255,255,255,0.15);
      color: #fff;
    }
    
    .pwa-banner-actions button:active {
      transform: scale(0.95);
    }
    
    /* PWA mode adjustments */
    body.pwa-mode {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }
  </style>
  
  <!-- ‚úÖ NOUVEAU: STRUCTURED DATA - Deep Linking Support -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MobileApplication",
    "name": "Mijoro Boutique",
    "operatingSystem": "Android, iOS, Windows",
    "applicationCategory": "ShoppingApplication",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "MGA"
    },
    "potentialAction": [
      {
        "@type": "ViewAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "web+mijoro://product/{product_id}",
          "actionPlatform": [
            "http://schema.org/DesktopWebPlatform",
            "http://schema.org/MobileWebPlatform"
          ]
        },
        "name": "Voir Produit"
      },
      {
        "@type": "ViewAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "web+mijoro://category/{category_name}",
          "actionPlatform": [
            "http://schema.org/DesktopWebPlatform",
            "http://schema.org/MobileWebPlatform"
          ]
        },
        "name": "Voir Cat√©gorie"
      },
      {
        "@type": "ViewAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "web+mijoro://cart",
          "actionPlatform": [
            "http://schema.org/DesktopWebPlatform",
            "http://schema.org/MobileWebPlatform"
          ]
        },
        "name": "Voir Panier"
      }
    ]
  }
  </script>
</head>
<body aria-busy="true">

<!-- ‚úÖ PWA INSTALL BANNER -->
<div id="pwa-install-banner" role="dialog" aria-labelledby="pwa-banner-title">
  <div class="pwa-banner-content">
    <div class="pwa-banner-icon">üì±</div>
    <div class="pwa-banner-text">
      <h4 id="pwa-banner-title">Installer Mijoro</h4>
      <p>Acc√®s rapide depuis votre √©cran d'accueil</p>
    </div>
  </div>
  <div class="pwa-banner-actions">
    <button class="pwa-dismiss-btn" onclick="dismissPWAPrompt()">Plus tard</button>
    <button class="pwa-install-btn" onclick="installPWA()">Installer</button>
  </div>
</div>

<!-- ========================================
LOADER PREMIUM
======================================== -->
<div id="loader" aria-hidden="false" role="status" aria-label="Chargement">
  <div class="loader-container">
    <div class="icon-wrapper">
      <svg class="boutique-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <path d="M50 10 L70 30 L70 70 L50 90 L30 70 L30 30 Z" stroke-width="2" fill="none" />
        <circle cx="50" cy="50" r="15" stroke-width="2" fill="none" />
        <path d="M50 35 L50 25 M50 75 L50 65 M35 50 L25 50 M75 50 L65 50" stroke-width="2" stroke-linecap="round" />
      </svg>
      <div class="ring ring-1"></div>
      <div class="ring ring-2"></div>
    </div>
    
    <div class="boutique-name">MiJORO BOUTIQUE</div>
    
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>
</div>


<!-- ========================================
     HOME SECTION
     ======================================== -->
<section id="home" class="active" aria-label="Accueil" aria-hidden="false">
  
  <!-- ‚úÖ NOUVEAU: Wrapper scrollable -->
  <div id="home-content">
    
    <!-- Slideshow -->
    <div class="slideshow" aria-label="Promotion">
      <div class="slide-track" id="slide-track">
        <!-- Slides rendered by JS -->
      </div>
      <div class="slide-dots" id="slide-dots" aria-hidden="true"></div>
    </div>
    
    <!-- Add Slide Button (Owner only) -->
    <div style="margin-top:16px; display:flex; justify-content:center; padding:0 12px">
      <button 
        id="btnAddSlide" 
        type="button" 
        class="param-btn owner-tool" 
        style="display:none; gap:6px; align-items:center" 
        title="Ajouter un slide" 
        aria-label="Ajouter un slide au carrousel"
        data-i18n="slide_add"
        data-i18n-title="slide_add">
        <i class="fa-solid fa-plus"></i>
        <span>Ajouter Slide</span>
      </button>
    </div>
    
    <!-- Subscribe Button -->
    <div style="margin-top:20px; display:flex; justify-content:center; padding:0 12px">
      <button 
        id="btnSubscribe" 
        type="button" 
        class="subscribe-btn"
        title="Recevoir les notifications de nouveaux produits"
        aria-label="S'abonner aux notifications"
        data-i18n-title="notif_subscribe">
        <i class="fa-solid fa-bell"></i>
        <span class="subscribe-text" data-i18n="notif_subscribe">S'abonner aux notifications</span>
      </button>
    </div>
    
    <!-- Home Title & Subtitle -->
    <h1 id="home-title" data-i18n="home_title">Tongasoa eto amin'ny fivarotana Malagasy!</h1>
    <p id="home-sub" data-i18n="home_sub">D√©couvre des eBooks, vid√©os et apps/jeux pour t'aider √† r√©ussir en ligne.</p>

    <!-- Quick Order Section -->
    <div class="quick-order-card" id="qoCard">
      <!-- Header with collapse button -->
      <div class="qo-header">
        <i class="fa-solid fa-bolt"></i>
        <h3>Commande Express</h3>
        <span class="qo-counter" id="qoCounter">0/8</span>
        <button type="button" 
                class="qo-toggle-btn" 
                id="qoToggle"
                aria-expanded="true"
                aria-label="Toggle Quick Order">
          <i class="fa-solid fa-chevron-up"></i>
        </button>
      </div>
      
      <!-- Owner Tools Bar -->
      <div class="qo-tools owner-tool" style="display:none">
        <button type="button" 
                class="qo-tool-btn" 
                id="qoAddBtn"
                title="Ajouter des produits">
          <i class="fa-solid fa-plus"></i>
          <span>Ajouter</span>
        </button>
        <button type="button" 
                class="qo-tool-btn qo-manage-btn" 
                id="qoManageBtn"
                title="G√©rer l'ordre">
          <i class="fa-solid fa-list"></i>
          <span>G√©rer</span>
        </button>
        <div class="qo-tools-more">
          <button type="button" 
                  class="qo-tool-btn-small" 
                  id="qoExportBtn"
                  title="Exporter">
            <i class="fa-solid fa-download"></i>
          </button>
          <button type="button" 
                  class="qo-tool-btn-small" 
                  id="qoImportBtn"
                  title="Importer">
            <i class="fa-solid fa-upload"></i>
          </button>
        </div>
        <input type="file" 
               id="qoImportFile" 
               accept=".json"
               style="display:none">
      </div>
      
      <!-- Content (collapsible) -->
      <div id="qoContent">
        <div class="qo-scroll-wrapper">
          <div class="qo-grid" id="featured-products">
            <!-- Products will be rendered here -->
          </div>
        </div>
        
        <button type="button" 
                class="qo-view-all" 
                onclick="showSection('shop')">
          <span>Voir tout</span>
          <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    </div>
    
  </div> <!-- ‚úÖ FIN de #home-content -->
  
  <!-- ‚ö†Ô∏è Les modals RESTENT EN DEHORS de #home-content -->
  
</section>

<!-- ‚úÖ Modals QO (en dehors de #home) -->
<div id="qo-add-modal" 
     class="modal-overlay" 
     aria-hidden="true"
     style="display:none">
  <div class="modal-card qo-modal">
    <div class="modal-header">
      <h3>Ajouter √† Quick Order</h3>
      <button type="button" 
              class="modal-close" 
              id="qoModalClose"
              aria-label="Fermer">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    
    <div class="modal-search">
      <input type="search" 
             id="qoSearchProducts" 
             placeholder="Rechercher un produit..."
             class="search-input">
    </div>
    
    <div class="qo-modal-products" id="qoModalProductsList">
    </div>
    
    <div class="modal-actions">
      <button type="button" 
              class="btn btn-secondary" 
              id="qoCancelBtn">
        Annuler
      </button>
      <button type="button" 
              class="btn btn-primary" 
              id="qoSaveBtn">
        <i class="fa-solid fa-check"></i>
        Enregistrer
      </button>
    </div>
  </div>
</div>

<div id="qo-manage-modal" 
     class="modal-overlay" 
     aria-hidden="true"
     style="display:none">
  <div class="modal-card qo-modal">
    <div class="modal-header">
      <h3>G√©rer Quick Order</h3>
      <button type="button" 
              class="modal-close" 
              id="qoManageModalClose"
              aria-label="Fermer">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    
    <p style="margin-bottom:16px; color:#94a3b8; font-size:14px;">
      Glissez pour r√©organiser, cliquez sur <i class="fa-solid fa-trash"></i> pour supprimer
    </p>
    
    <div class="qo-manage-list" id="qoManageList">
    </div>
    
    <div class="modal-actions">
      <button type="button" 
              class="btn btn-secondary" 
              id="qoManageCancelBtn">
        Fermer
      </button>
      <button type="button" 
              class="btn btn-danger" 
              id="qoClearAllBtn">
        <i class="fa-solid fa-trash"></i>
        Tout supprimer
      </button>
    </div>
  </div>
</div>
</section>
<!-- ========================================
     SHOP SECTION
     ======================================== -->
<section id="shop" class="section" aria-label="Boutique - Produits num√©riques" aria-hidden="true">


  <!-- ========== HEADER FIXE (Tools + Filters + Search) ========== -->
  <div id="shop-header">
    
    <!-- Tools toggle button (gear) -->
    <div style="padding: 8px 10px;">
      <button
        id="shopToolsToggle"
        class="tools-toggle"
        type="button"
        aria-label="Afficher/Masquer les outils du shop"
        aria-expanded="false"
        aria-controls="shop-tools"
        style="display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:10px;border:none;cursor:pointer;color:#fff;background:linear-gradient(180deg, color-mix(in srgb, #334155 92%, #fff 8%), #334155);box-shadow:0 8px 18px rgba(0,0,0,.25);">
        <i class="fa-solid fa-sliders" style="font-size:16px;"></i>
      </button>
    </div>

    <!-- SHOP TOOLS (collapse section) -->
    <div id="shop-tools" class="shop-tools" role="region" aria-label="Outils de la boutique" style="overflow:clip;max-height:0;opacity:0;transform:translateY(-6px);transition:max-height .28s ease,opacity .18s ease,transform .28s ease;pointer-events:none;margin:0 10px;">
      
      <!-- Topbar: titre + actions -->
      <header class="shop-topbar" role="banner"
        style="display:grid;grid-template-columns:1fr auto 1fr;align-items:center;min-height:52px;padding:8px 4px;">
        <h2 class="shop-title"
          data-i18n="shop_title"
          style="grid-column:2;justify-self:center;margin:0;font-size:18px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">
          Nos Produits Num√©riques
        </h2>

        <div class="shop-actions"
          style="grid-column:3;justify-self:end;display:inline-flex;align-items:center;gap:8px;margin-right:max(2px, env(safe-area-inset-right));">
          
          <!-- Login Button -->
          <button 
            id="btnLogin" 
            class="icon-btn" 
            title="Login (Owner only)" 
            aria-label="Login"
            data-i18n-title="auth_login"
            style="width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;border:none;border-radius:10px;cursor:pointer;background:linear-gradient(180deg, color-mix(in srgb, #2563eb 92%, #fff 8%), #2563eb);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.18);">
            <i class="fa-solid fa-right-to-bracket"></i>
          </button>
          
          <!-- Logout Button -->
          <button 
            id="btnLogout" 
            class="icon-btn" 
            title="Logout" 
            aria-label="Logout"
            data-i18n-title="auth_logout"
            style="display:none;width:36px;height:36px;display:inline-flex;align-items:center;justify-content:center;border:none;border-radius:10px;cursor:pointer;background:linear-gradient(180deg, color-mix(in srgb, #ef4444 92%, #fff 8%), #ef4444);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.18);">
            <i class="fa-solid fa-right-from-bracket"></i>
          </button>
          
          <!-- Add Digital Product Button -->
          <button 
            id="btnAddProduct" 
            class="param-btn" 
            title="Add product"
            data-i18n-title="manage_add_product"
            style="display:none;height:36px;display:inline-flex;align-items:center;gap:8px;border:none;border-radius:10px;padding:0 12px;background:linear-gradient(180deg, color-mix(in srgb, #16a34a 92%, #fff 8%), #16a34a);color:#fff;font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.18);">
            <i class="fa-solid fa-plus"></i> 
            <span data-i18n="manage_add_digital">numerique</span>
          </button>
          
          <!-- Add Physical Product Button -->
          <button 
            id="btnAddPhysical" 
            class="param-btn owner-tool" 
            title="Ajouter produit physique"
            data-i18n-title="manage_add_physical"
            style="display:none;height:36px;display:inline-flex;align-items:center;gap:6px;border:none;border-radius:10px;padding:0 12px;background:linear-gradient(180deg, color-mix(in srgb, #10b981 92%, #fff 8%), #10b981);color:#fff;font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.18);">
            <i class="fa-solid fa-box"></i> 
            <span data-i18n="manage_add_physical">Physique</span>
          </button>
        </div>
      </header>

      <!-- Toolbar: Search + Filters -->
      <div class="shop-toolbar" role="region" aria-label="Recherche et filtres" style="display:grid;gap:10px;margin:6px 0 10px;">
        
        <!-- ‚úÖ SEARCH (FIXED VERSION) -->
        <div class="search" style="position:relative">
          <label for="search" class="sr-only" data-i18n="search_placeholder">Recherche produits</label>
          
          <!-- Search Icon -->
          <i class="fa-solid fa-magnifying-glass" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#909aa3;font-size:16px;pointer-events:none;z-index:1"></i>
          
          <!-- Input -->
          <input
            id="search"
            type="search"
            placeholder="Rechercher..."
            aria-label="Recherche produits"
            data-i18n="search_placeholder"
            data-i18n-placeholder
            autocomplete="off"
            inputmode="search"
            style="width:100%;height:40px;padding:8px 12px 8px 38px;border:1px solid #cfd6df;background-color:#ffffff;color:#111111;border-radius:999px;outline:none;font-size:14px;box-shadow:0 1px 2px rgba(0,0,0,.04)">
        </div>

        <!-- Filters -->
        <div class="filters" id="filters" role="toolbar" aria-label="Filtrer les produits" style="display:flex;gap:8px;overflow-x:auto;padding-bottom:2px;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none;">
          
         <button type="button" class="filter-btn active" data-category="all">
  <i class="fa-solid fa-grip"></i>
  <span data-i18n="filter_all">Tous</span>
</button>
          
         <button type="button" class="filter-btn" data-category="ebooks">
  <i class="fa-solid fa-book-open"></i>
  <span data-i18n="filter_ebooks">eBooks</span>
</button>
          
          <button type="button" class="filter-btn" data-category="videos">
    <i class="fa-solid fa-circle-play"></i>
    <span data-i18n="filter_videos">Vid√©os</span>
  </button>
  <button type="button" class="filter-btn" data-category="apps">
    <i class="fa-solid fa-mobile-screen-button"></i>
    <span>Apps/Jeux</span>
  </button>
  
          
        <button type="button" class="filter-btn" data-category="vip">
    <i class="fa-solid fa-crown"></i>
    <span data-i18n="filter_vip">VIP</span>
  </button>
  
        <button type="button" class="filter-btn" data-category="promo">
  <i class="fa-solid fa-bolt"></i>
  <span data-i18n="filter_promo">Promo</span>
</button>
          <button type="button" class="filter-btn" data-category="free">
   <i class="fa-solid fa-gift"></i>
   <span data-i18n="filter_free">Gratuit</span>
 </button>

        </div>
      </div>
    </div>
    
  </div>
  
<!-- ========== SCROLLABLE PRODUCTS WRAPPER ========== -->
<div id="products-wrapper">
  
  <!-- Mobile/Tablet View (Vertical Scroll) -->
  <div id="products-row" class="products-row" role="list" aria-label="Liste des produits ‚Äî d√©filement vertical">
    <!-- Products cards rendered here by JS -->
  </div>
  
  <!-- ‚úÖ VAOVAO: Pagination for products-row -->
  <div id="pagination-row"></div>
  
  <!-- Desktop View (Grid) -->
  <div id="products-box" style="display:none">
    <!-- Alternative grid view -->
  </div>
  
  <!-- ‚úÖ VAOVAO: Pagination for products-box -->
  <div id="pagination-box"></div>
  
</div>
</section>

<!-- ==========================================
     CART DRAWER - COMPLETE STRUCTURE
     ========================================== -->

<!-- Cart Drawer -->
<div id="cdCartDrawer" class="cd-cart-drawer" aria-hidden="true">
  <!-- Header -->
<div class="cd-cart-header">
  <button type="button" class="cd-cart-close" aria-label="Retour">
    <i class="fa-solid fa-arrow-left"></i> <!-- ‚úÖ VAOVAO: arrow-left -->
  </button>
  <h2 class="cd-cart-title">
    <i class="fa-solid fa-cart-shopping"></i>
    <span>Panier</span>
  </h2>

  </div>
  
  <!-- Body (items container) -->
  <div id="cdCartBody" class="cd-cart-body">
    <!-- Items rendered dynamically -->
  </div>
  
  <!-- Footer -->
  <div class="cd-cart-footer">
    <div class="cd-footer-total">
      <span class="cd-total-label">Total</span>
      <div id="cdCartTotal">
        <i class="fa-solid fa-coins"></i>
        <span>0 Ar</span>
      </div>
    </div>
    
    <div class="cd-footer-actions">
      <button 
        type="button" 
        class="cd-icon-btn cd-btn-clear" 
        id="cdClearBtn"
        data-tooltip="Vider"
        aria-label="Vider le panier">
        <i class="fa-solid fa-trash"></i>
      </button>
      
      <button 
        type="button" 
        class="cd-icon-btn cd-btn-checkout" 
        id="cdCheckoutBtn"
        data-tooltip="Commander via WhatsApp"
        aria-label="Commander via WhatsApp">
        <i class="fa-brands fa-whatsapp"></i>
      </button>
    </div>
  </div>
</div>

<!-- Backdrop -->
<div id="cdBackdrop" hidden></div>

<!-- FAB Button -->
<button id="cdCartFab" aria-label="Ouvrir le panier">
  <i class="fa-solid fa-shopping-cart"></i>
  <span id="cdCartBadge">0</span>
</button>
<!-- ==========================================
     BOTTOM NAVIGATION - 5 ITEMS ‚úÖ
     Home / Shop / Cart / Miora / Params
     ========================================== -->
<nav class="bottom-nav" role="navigation" aria-label="Navigation principale">
  
  <!-- HOME -->
  <button type="button" class="nav-btn active" data-section="home" aria-label="Home" data-i18n-aria-label="nav_home">
    <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
      <path d="M3 11.5 12 4l9 7.5V20a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1z" fill="currentColor" />
    </svg>
    <span class="label" data-i18n="nav_home">Home</span>
  </button>
  
  <!-- SHOP -->
  <button type="button" class="nav-btn" data-section="shop" aria-label="Shop" data-i18n-aria-label="nav_shop">
    <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
      <path d="M3 7h18l-1.5 11.5a1 1 0 0 1-1 .9H6.5a1 1 0 0 1-1-.9L4 7zM7 4h10v2H7z" fill="currentColor" />
    </svg>
    <span class="label" data-i18n="nav_shop">Shop</span>
  </button>
  
  <!-- CART - NOUVEAU! ‚úÖ -->
  <button type="button" class="nav-btn nav-btn-cart" id="nav-cart-btn" aria-label="Panier" data-i18n-aria-label="nav_cart">
    <div class="nav-cart-wrapper">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
        <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" fill="currentColor" />
      </svg>
      <span class="nav-cart-badge" id="nav-cart-badge">0</span>
    </div>
    <span class="label" data-i18n="nav_cart">Panier</span>
  </button>
  
<!-- ‚úÖ AGENT MIORA BUTTON -->
<button type="button" class="nav-btn" id="nav-agent" aria-label="Agent Miora" aria-controls="agent-chat">
  <img src="https://i.ibb.co/fVfNcLv9/file-000000008188722fb075911ad3cee715.png" 
       alt="Agent Miora" 
       class="icon-miora"
       loading="lazy">
  <span class="label">Agent Miora</span>
</button>
  
  <!-- PARAMS -->
  <button type="button" class="nav-btn" data-section="params" aria-label="Param√®tre" data-i18n-aria-label="nav_params">
    <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
      <path d="M19.4 12.9a7.2 7.2 0 0 0 0-1.8l2.1-1.6a.5.5 0 0 0 .1-.6l-2-3.4a.5.5 0 0 0-.6-.2l-2.5 1a7.1 7.1 0 0 0-1.6-.9L14 2.4a.5.5 0 0 0-.5-.4h-4a.5.5 0 0 0-.5.4l-.4 2.7a7.1 7.1 0 0 0-1.6.9l-2.5-1a.5.5 0 0 0-.6.2l-2 3.4a.5.5 0 0 0 .1.6L4.6 11a7.2 7.2 0 0 0 0 1.8L2.5 14.4a.5.5 0 0 0-.1.6l2 3.4c.1.2.4.3.6.2l2.5-1c.5.4 1 0 1.6.9l.4 2.7c.05.2.2.4.4.4h4c.2 0 .4-.2.4-.4l.4-2.7c.6-.9 1.1-.5 1.6-.9l2.5 1c.2.1.5 0 .6-.2l2-3.4a.5.5 0 0 0-.1-.6l-2.1-1.6zM12 15.5A3.5 3.5 0 1 1 12 8.5a3.5 3.5 0 0 1 0 7z" fill="currentColor" />
    </svg>
    <span class="label" data-i18n="nav_params">Param√®tre</span>
  </button>
</nav>
<!-- ==========================================
     PARAM FIXED PANEL
     ========================================== -->
<aside id="param-fixed" class="hidden" aria-hidden="true" role="region" aria-label="Param√®tres" inert>
  
  <!-- Header -->
  <div style="display:flex;align-items:center;gap:10px">
    <img src="https://i.ibb.co/zTvNMMQd/743c16d58accff74c1c37793816bd25f.jpg" alt="param" style="width:46px;height:46px;border-radius:8px;object-fit:cover;border:1px solid rgba(255,255,255,.06)">
    <div>
      <h4 style="margin-bottom:4px" data-i18n="param_settings">Param√®tres</h4>
      <small style="color:#ddd">Personnalisez votre exp√©rience</small>
    </div>
  </div>

  <!-- ========================================
       LANGUE SECTION
       ======================================== -->
  <div class="settings-section">
    <h4 style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
      <i class="fa-solid fa-globe"></i>
      <span data-i18n="param_language">Langue</span>
    </h4>

    <div id="lang-options"
         class="option-grid"
         role="radiogroup"
         aria-label="S√©lection de la langue">
         
      <!-- Malagasy -->
      <button type="button"
              class="option-card"
              role="radio"
              aria-checked="false"
              tabindex="-1"
              data-lang="mg">
        <div class="option-icon icon-mg">
          <span aria-hidden="true">üá≤üá¨</span>
        </div>
        <div class="option-texts">
          <div class="option-title" data-i18n="lang_mg">Malagasy</div>
          <div class="option-sub" data-i18n="lang_mg_sub">Lazao amin'ny fiteny gasy</div>
        </div>
      </button>

      <!-- Fran√ßais -->
      <button type="button"
              class="option-card active"
              role="radio"
              aria-checked="true"
              tabindex="0"
              data-lang="fr">
        <div class="option-icon icon-fr">
          <span aria-hidden="true">üá´üá∑</span>
        </div>
        <div class="option-texts">
          <div class="option-title" data-i18n="lang_fr">Fran√ßais</div>
          <div class="option-sub" data-i18n="lang_fr_sub">Interface en fran√ßais</div>
        </div>
      </button>

      <!-- English -->
      <button type="button"
              class="option-card"
              role="radio"
              aria-checked="false"
              tabindex="-1"
              data-lang="en">
        <div class="option-icon icon-en">
          <span aria-hidden="true">üá¨üáß</span>
        </div>
        <div class="option-texts">
          <div class="option-title" data-i18n="lang_en">English</div>
          <div class="option-sub" data-i18n="lang_en_sub">English interface</div>
        </div>
      </button>
    </div>
    
    <!-- Current language info -->
    <div style="margin-top:12px;padding:10px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:8px;display:flex;align-items:center;gap:8px;font-size:13px">
      <i class="fa-solid fa-circle-info" style="color:#10b981"></i>
      <span style="color:var(--text-secondary)">
        <span data-i18n="param_language">Langue</span>: 
        <strong id="current-lang-label" style="color:#10b981">Fran√ßais</strong>
      </span>
    </div>
  </div>

  <!-- ========================================
       TH√àME SECTION
       ======================================== -->
  <div class="settings-section">
    <h4 style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
      <i class="fa-solid fa-palette"></i>
      <span data-i18n="param_theme">Th√®me</span>
    </h4>

    <div id="theme-options"
         class="option-grid"
         role="radiogroup"
         aria-label="S√©lection du th√®me">

      <!-- Dark Theme -->
      <button type="button"
              class="option-card active"
              role="radio"
              aria-checked="true"
              tabindex="0"
              data-theme="dark">
        <div class="option-icon icon-dark">
          <i class="fa-solid fa-moon" aria-hidden="true"></i>
        </div>
        <div class="option-texts">
          <div class="option-title" data-i18n="theme_dark">Sombre</div>
          <div class="option-sub" data-i18n="theme_dark_sub">Par d√©faut</div>
        </div>
      </button>

      <!-- Light Theme -->
      <button type="button"
              class="option-card"
              role="radio"
              aria-checked="false"
              tabindex="-1"
              data-theme="light">
        <div class="option-icon icon-light">
          <i class="fa-solid fa-sun" aria-hidden="true"></i>
        </div>
        <div class="option-texts">
          <div class="option-title" data-i18n="theme_light">Clair</div>
          <div class="option-sub" data-i18n="theme_light_sub">Lumineux</div>
        </div>
      </button>
    </div>
    
    <!-- Current theme info -->
    <div style="margin-top:12px;padding:10px;background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.2);border-radius:8px;display:flex;align-items:center;gap:8px;font-size:13px">
      <i class="fa-solid fa-circle-info" style="color:#3b82f6"></i>
      <span style="color:var(--text-secondary)">
        <span data-i18n="theme_current">Th√®me actuel:</span> 
        <strong id="current-theme-label" style="color:#3b82f6">Sombre</strong>
      </span>
    </div>
  </div>

  <!-- ========================================
       MODE D'AFFICHAGE SECTION
       ======================================== -->
  <div class="param-section">
    <h4 style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
      <i class="fa-solid fa-display"></i>
      <span data-i18n="param_mode">Mode d'affichage</span>
    </h4>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <!-- Mode Mobile -->
      <button type="button" 
              class="mode-switch-btn active" 
              data-mode="mobile"
              style="display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px;border:2px solid rgba(59,130,246,.3);background:linear-gradient(135deg,rgba(59,130,246,.15),rgba(37,99,235,.1));border-radius:12px;cursor:pointer;transition:all 0.2s ease">
        <i class="fa-solid fa-mobile-screen-button" style="font-size:32px;color:#3b82f6"></i>
        <span style="font-weight:700;color:#3b82f6" data-i18n="param_mode_mobile">Mobile</span>
        <small style="opacity:.7;font-size:11px;text-align:center;color:#94a3b8">Affichage mobile<br>(par d√©faut)</small>
      </button>
      
      <!-- Mode Desktop -->
      <button type="button" 
              class="mode-switch-btn" 
              data-mode="desktop"
              style="display:flex;flex-direction:column;align-items:center;gap:8px;padding:16px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);border-radius:12px;cursor:pointer;transition:all 0.2s ease">
        <i class="fa-solid fa-desktop" style="font-size:32px;color:#94a3b8"></i>
        <span style="font-weight:700;color:#94a3b8" data-i18n="param_mode_desktop">Desktop</span>
        <small style="opacity:.7;font-size:11px;text-align:center;color:#64748b">Affichage large<br>(√©cran PC)</small>
      </button>
    </div>
    
    <!-- Info Badge -->
    <div id="current-mode-info" style="margin-top:12px;padding:10px;background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.2);border-radius:8px;display:flex;align-items:center;gap:8px;font-size:13px">
      <i class="fa-solid fa-circle-info" style="color:#3b82f6"></i>
      <span style="color:#e5e7eb">
        <span data-i18n="param_mode_current">Mode actuel:</span> 
        <strong id="mode-label" style="color:#3b82f6">Mobile</strong>
      </span>
    </div>
  </div>
<!-- ========================================
     MIORA AI ASSISTANT SETTINGS (OWNER ONLY)
     ======================================== -->
<div class="param-section owner-tool" id="miora-settings-section" style="display:none">
  <h4 style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
    <img src="https://i.ibb.co/5xkSKtLt/IMG-20251116-WA0000.jpg" 
         alt="Miora" 
         style="width:28px;height:28px;border-radius:50%;border:2px solid rgba(102,126,234,.3)">
    <span>Miora AI Assistant</span>
    <span style="font-size:11px;padding:2px 8px;background:rgba(102,126,234,.2);border-radius:6px;color:#667eea;font-weight:700">PRO</span>
  </h4>
  
  <p style="margin-bottom:16px;color:#94a3b8;font-size:13px;line-height:1.5">
    Configuration compl√®te de votre assistant IA avec support multi-mod√®les et fallback automatique.
  </p>

  <!-- Status Badge -->
  <div id="miora-status-badge" style="margin-bottom:16px;padding:12px;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:10px;display:flex;align-items:center;gap:10px;font-size:13px">
    <i class="fa-solid fa-exclamation-triangle" style="color:#ef4444;font-size:18px"></i>
    <div>
      <div style="color:#ef4444;font-weight:700;margin-bottom:2px">‚ö†Ô∏è Aucune API configur√©e</div>
      <div style="color:#94a3b8;font-size:12px">Configurez au moins un mod√®le AI pour activer Miora</div>
    </div>
  </div>

  <!-- Quick Config Button -->
  <button type="button" 
          class="param-btn" 
          onclick="window.mioraOpenSettings()"
          style="width:100%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border:none;color:#fff;font-weight:700;padding:14px;border-radius:12px;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 6px 20px rgba(102,126,234,.3);margin-bottom:12px">
    <i class="fa-solid fa-sliders"></i>
    <span>Configurer Miora AI</span>
  </button>

  <!-- Stats Grid -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
    <div style="padding:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:10px">
      <div style="color:#94a3b8;font-size:11px;margin-bottom:4px">Messages</div>
      <div style="color:#fff;font-size:20px;font-weight:800" id="miora-stats-messages">0</div>
    </div>
    <div style="padding:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:10px">
      <div style="color:#94a3b8;font-size:11px;margin-bottom:4px">Mod√®le actif</div>
      <div style="color:#10b981;font-size:14px;font-weight:700" id="miora-stats-model">-</div>
    </div>
  </div>

  <!-- Features Info -->
  <div style="padding:12px;background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:10px;margin-bottom:12px">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
      <i class="fa-solid fa-sparkles" style="color:#10b981"></i>
      <strong style="color:#10b981;font-size:14px">Fonctionnalit√©s disponibles</strong>
    </div>
    <ul style="margin:0;padding-left:20px;color:#94a3b8;font-size:12px;line-height:1.8">
      <li>Multi-AI: Groq, Gemini, OpenAI, Claude, etc.</li>
      <li>Fallback automatique si mod√®le indisponible</li>
      <li>G√©n√©ration d'images (Pollinations AI)</li>
      <li>Reconnaissance vocale & synth√®se</li>
      <li>Th√®mes personnalisables (6 th√®mes)</li>
      <li>Mode sombre automatique</li>
      <li>Export/Import conversations</li>
      <li>Statistiques d√©taill√©es</li>
    </ul>
  </div>

  <!-- Quick Actions -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
    <button type="button" 
            class="param-btn" 
            onclick="window.mioraOpenAnalytics()"
            style="font-size:13px;padding:10px;background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);color:#3b82f6">
      <i class="fa-solid fa-chart-line"></i>
      <span>Statistiques</span>
    </button>
    <button type="button" 
            class="param-btn" 
            onclick="exportConversation()"
            style="font-size:13px;padding:10px;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:#10b981">
      <i class="fa-solid fa-download"></i>
      <span>Exporter</span>
    </button>
  </div>

  <!-- Documentation Link -->
  <div style="margin-top:12px;text-align:center">
    <a href="#" 
       onclick="alert('üìö Documentation Miora AI:\n\n1. Configurez vos cl√©s API\n2. Activez les mod√®les souhait√©s\n3. Testez avec Quick Actions\n4. Activez le fallback pour fiabilit√©\n\nüí° Les mod√®les GRATUITS: Groq, Gemini, Cohere'); return false;"
       style="color:#667eea;font-size:12px;text-decoration:none;display:inline-flex;align-items:center;gap:6px">
      <i class="fa-solid fa-book"></i>
      <span>Documentation & Aide</span>
    </a>
  </div>
</div>
  <!-- ========================================
       ACTION BUTTONS
       ======================================== -->
  <div class="row" style="justify-content:space-between; margin-top:8px;">
    <button type="button" class="param-btn" onclick="openInfo('about')" data-i18n="about">√Ä propos</button>
    <button type="button" class="param-btn" onclick="openInfo('contact')" data-i18n="contact">Contact</button>
    <button type="button" class="param-btn" onclick="openQuitModal()" data-i18n="quit">Quit</button>
  </div>
</aside>

<!-- ========================================
     QUIT MODAL
     ======================================== -->
<div id="quit-modal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1" aria-labelledby="quit-title">
  <div class="modal-card" role="document">
    <h3 id="quit-title" data-i18n="quit_confirm">Voulez-vous quitter l'application ?</h3>
    <p style="margin:8px 0 12px" data-i18n="quit_message">Tsy ho very ny angon-drakitrao.</p>
    <div style="display:flex;justify-content:center;gap:10px;margin-top:8px">
      <button type="button" class="param-btn" onclick="closeQuitModal()" data-i18n="btn_cancel">Annuler</button>
      <button type="button" class="param-btn" style="background:#ef4444;border-color:#ef4444" onclick="quitApp()" data-i18n="quit">Quitter</button>
    </div>
  </div>
</div>

<!-- ========================================
     INFO MODAL
     ======================================== -->
<div id="info-modal" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1" aria-labelledby="info-title">
  <div class="info-card" role="document">
    <h3 id="info-title">Informations</h3>
    <div id="info-content"></div>
    <div class="info-actions">
      <button type="button" class="param-btn" onclick="closeInfo()" data-i18n="btn_close">Fermer</button>
    </div>
  </div>
</div>
<!-- ==========================================
     AGENT MIORA - CHAT WINDOW COMPLETE
     ========================================== -->
<div id="agent-chat" class="agent-chat-window" aria-hidden="true" role="dialog" aria-labelledby="agent-title">
  <!-- Header -->
  <div class="agent-header">
    <div style="display: flex; align-items: center; gap: 10px;">
      <img src="https://i.ibb.co/fVfNcLv9/file-000000008188722fb075911ad3cee715.png" 
           alt="Agent Miora" 
           style="width: 36px; height: 36px; border-radius: 50%;">
      <div>
        <div id="agent-title" style="font-weight: 700; font-size: 15px;">Agent Miora</div>
        <div style="font-size: 11px; opacity: 0.8;">Universal AI Assistant</div>
      </div>
    </div>
    
    <button class="agent-close" id="agent-close" aria-label="Fermer">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <!-- Messages Container -->
  <div id="agent-messages" class="agent-messages">
    <!-- Messages will be added here by JS -->
  </div>

  <!-- Input Area -->
  <div class="agent-input-area">
    <textarea 
      id="agent-input" 
      placeholder="Tapez votre message..." 
      class="agent-input"
      rows="1"
      maxlength="2000"></textarea>
    
    <button class="agent-send" id="agent-send" aria-label="Envoyer">
      <i class="fa-solid fa-paper-plane"></i>
    </button>
  </div>
</div>
  
  <!-- Image Preview -->
  <div class="miora-image-preview" id="miora-image-preview">
    <div class="miora-preview-container">
      <img id="miora-preview-img" class="miora-preview-img" alt="Preview">
      <button class="miora-preview-remove" id="miora-preview-remove" aria-label="Remove">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">
  

// ==========================================
// PWA MODE DETECTION
// ==========================================

window.addEventListener('DOMContentLoaded', () => {
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone ||
    document.referrer.includes('android-app://');
  
  if (isStandalone) {
    console.log('üöÄ Running in PWA mode');
    document.body.classList.add('pwa-mode');
    
    const banner = document.getElementById('pwa-install-banner');
    if (banner) banner.style.display = 'none';
    
    // ‚úÖ Check capabilities
    if ('launchQueue' in window) {
      console.log('[PWA] ‚úÖ File Handlers supported');
    }
    if ('registerProtocolHandler' in navigator) {
      console.log('[PWA] ‚úÖ Protocol Handlers supported');
    }
    
    return;
  }
  
  console.log('üåê Running in browser mode');
  
  setTimeout(() => {
    const banner = document.getElementById('pwa-install-banner');
    if (banner && !localStorage.getItem('pwa-dismissed')) {
      banner.classList.add('show');
    }
  }, 30000);
});

window.installPWA = async function() {
  if (!window.deferredPrompt) {
    alert('Installation non disponible');
    return;
  }
  
  try {
    await window.deferredPrompt.prompt();
    const { outcome } = await window.deferredPrompt.userChoice;
    
    if (outcome === 'accepted') {
      document.getElementById('pwa-install-banner')?.remove();
      setTimeout(() => {
        alert(
          '‚úÖ Installation r√©ussie!\n\n' +
          'üéâ Fonctionnalit√©s:\n' +
          '‚Ä¢ File Handlers\n' +
          '‚Ä¢ Deep Linking\n' +
          '‚Ä¢ Widgets'
        );
      }, 2000);
    }
    
    window.deferredPrompt = null;
  } catch (e) {
    console.error('[PWA] Error:', e);
  }
};
window.dismissPWAPrompt = function() {
  document.getElementById('pwa-install-banner')?.remove();
  localStorage.setItem('pwa-dismissed', 'true');
};

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  window.deferredPrompt = e;
  console.log('[PWA] Install prompt captured');
});

window.addEventListener('appinstalled', () => {
  console.log('[PWA] ‚úÖ App installed');
  window.deferredPrompt = null;
  
  setTimeout(() => {
    if (typeof requestNotificationPermission === 'function') {
      requestNotificationPermission();
    }
  }, 3000);
});
</script>

<!-- ========================================
     LOADER GUARD + iOS VH PATCH
     ======================================== -->
<script>
  (function(){
    var MAX_WAIT_MS = 8000, SOFT_WAIT_MS = 400;
    function qs(s){ return document.querySelector(s); }
    function hideLoader(){
      var l = qs('#loader'); if(!l) return;
      l.classList.add('fade-out');
      l.setAttribute('aria-hidden','true');
      l.style.pointerEvents = 'none';
      setTimeout(function(){ l.style.display = 'none'; }, 500);
    }
    function revealBaseUI(){
      try {
        document.body.setAttribute('aria-busy','false');
        var home = document.getElementById('home');
        if (home){ home.classList.add('active'); home.setAttribute('aria-hidden','false'); }
        var bm = qs('.bottom-nav');
        if (bm){ bm.style.display = 'flex'; bm.style.pointerEvents = 'auto'; }
      } catch(_) {}
    }
    function onReady(cb){
      if (document.readyState === 'complete' || document.readyState === 'interactive') cb();
      else document.addEventListener('DOMContentLoaded', cb, { once: true });
    }
    onReady(function(){
      setTimeout(revealBaseUI, SOFT_WAIT_MS);
      setTimeout(function(){ hideLoader(); revealBaseUI(); }, MAX_WAIT_MS);
    });
  })();
</script>

<script>
  (function(){
    function setVH(){ var vh = window.innerHeight * 0.01; document.documentElement.style.setProperty('--vh', vh + 'px'); }
    window.addEventListener('resize', setVH);
    window.addEventListener('orientationchange', setVH);
    setVH();
  })();
</script>

<div class="touch-edge-bottom" aria-hidden="true"></div>


<!-- App bundle -->
<script src="app.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>